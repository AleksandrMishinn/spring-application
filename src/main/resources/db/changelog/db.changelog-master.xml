<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet id="1.0.0" author="aleksandr.mishin">
        <createTable tableName="user">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="userPK" nullable="false"/>
            </column>

            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false" unique="true"/>
            </column>

            <column name="role_id" type="BIGINT">
                <constraints nullable="false" unique="true"/>
            </column>

            <column name="username" type="VARCHAR(255)">
                <constraints nullable="false" unique="true"/>
            </column>

            <column name="password" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="1.0.1" author="aleksandr.mishin">
        <createTable tableName="dictionary">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" primaryKeyName="dictionaryPK"/>
            </column>

            <column name="discriminator" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>

            <column name="name" type="VARCHAR(255)">
            </column>

            <column name="ext_id" type="VARCHAR(255)">
            </column>
        </createTable>
    </changeSet>

    <changeSet id="1.0.2" author="aleksandr.mishin">
        <addForeignKeyConstraint
                baseColumnNames="role_id"
                baseTableName="user"
                baseTableSchemaName="universal"
                constraintName="fk_role_user"
                deferrable="false"
                initiallyDeferred="false"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedColumnNames="id"
                referencedTableName="dictionary"
                referencedTableSchemaName="universal"/>
    </changeSet>

    <changeSet id="1.0.3" author="aleksandr.mishin">
        <addUniqueConstraint
                columnNames="discriminator, name"
                constraintName="discriminator_name"
                deferrable="false"
                initiallyDeferred="false"
                schemaName="universal"
                tableName="dictionary"/>
    </changeSet>

    <changeSet id="1.0.4" author="aleksandr.mishin">
        <insert tableName="dictionary" schemaName="universal">
            <column name="id">1</column>
            <column name="discriminator">ROLE</column>
            <column name="name">ADMIN</column>
            <column name="ext_id">ADMIN</column>
        </insert>

        <insert tableName="dictionary" schemaName="universal">
            <column name="id">2</column>
            <column name="discriminator">ROLE</column>
            <column name="name">USER</column>
            <column name="ext_id">USER</column>
        </insert>
    </changeSet>

    <changeSet id="1.0.5" author="aleksandr.mishin">
        <insert tableName="user" schemaName="universal">
            <column name="id">1</column>
            <column name="name">admin</column>
            <column name="username">admin</column>
            <column name="role_id">1</column>
        </insert>

        <insert tableName="user" schemaName="universal">
            <column name="id">2</column>
            <column name="name">user</column>
            <column name="username">user</column>
            <column name="role_id">2</column>
        </insert>

        <insert tableName="user" schemaName="universal">
            <column name="id">3</column>
            <column name="name">second user</column>
            <column name="username">second user</column>
            <column name="role_id">2</column>
        </insert>
    </changeSet>

</databaseChangeLog>